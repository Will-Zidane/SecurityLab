# 19110113, Phạm  Ngọc Duy Đan
# Task 1:  Encrypt and Decrypt Text file 
## Set up encrypted file

<span style="color:blue">First we create  </span>``plain.txt``<span style="color:blue"> with content</span> ``“My 
name is ....” ``<br>
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2021.45.39.png?raw=true"><br>

## Encrypt and Decrypt file using AES-256-CBC and AES-256-ECD Mode
<span style="color:blue">In this lab I will use AES-256-ECB mode and AES-256-CBC to encrypt and decrypt the file : </span>
### Encrypt the file using AES-256-ECB mode
<span style="color:blue">I use </span>``openssl enc -aes-256-ecb -nosalt -in plain.txt -out ecb_encrypted.txt -K 00112233445566778899AABBCCDDEEFF00112233445566778899AABBCCDDEEFF``<span style="color:blue"> to encrypt  the encrypted file using  AES-256-ECB and create a ``ecb_encrypted.txt`` file</span><span style="color:blue"><br> and </span>``xxd ecb_encrypted.txt`` <span style="color:blue"> to display it</span><br>
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2021.51.00.png?raw=true"><br>
<span style="color:blue"> We can see that the content was encrypted.</span><br>

### Decrypt the file using AES-256-ECB mode
<span style="color:blue"> Now we decrypt the ``ecb_encrypted.txt`` file:</span><br>
<span style="color:blue">I use </span>``openssl enc -d -aes-256-ecb -nosalt -in ecb_encrypted.txt -out ecb_decrypted.txt -K 00112233445566778899AABBCCDDEEFF00112233445566778899AABBCCDDEEFF
``<span style="color:blue"> to decrypt ``ecb_encrypted.txt`` file then create a``ecb_decrypted.txt`` file </span><span style="color:blue"><br> and </span>``xxd ecb_decrypted.txt`` <span style="color:blue"> to display it</span><br>
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2022.06.12.png?raw=true"><br>
<span style="color:blue"> We can see that the content was decrypted correctly.</span><br>

### Encrypt the file using AES-256-CBC mode
<span style="color:blue">I use </span>``openssl enc -aes-256-cbc -nosalt -in plain.txt -out cbc_encrypted.txt -K 00112233445566778899AABBCCDDEEFF00112233445566778899AABBCCDDEEFF -iv 0102030405060708090A0B0C0D0E0F10
``<span style="color:blue"> to encrypt  the encrypted file using  AES-256-ECB and create a ``cbc_encrypted.txt`` file</span><span style="color:blue"><br> and </span>``xxd cbc_encrypted.txt`` <span style="color:blue"> to display it</span><br>
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2022.05.53.png?raw=true"><br>
<span style="color:blue"> We can see that the content was encrypted.</span><br>

### Decrypt the file using AES-256-CBC mode
<span style="color:blue"> Now we decrypt the ``cbc_encrypted.txt`` file:</span><br>
<span style="color:blue">I use </span>``openssl enc -d -aes-256-cbc -nosalt -in cbc_encrypted.txt -out cbc_decrypted.txt -K 00112233445566778899AABBCCDDEEFF00112233445566778899AABBCCDDEEFF -iv 0102030405060708090A0B0C0D0E0F10
``<span style="color:blue"> to decrypt ``cbc_encrypted.txt`` file then create ``cbc_decrypted.txt`` file</span><span style="color:blue"><br> and </span>``xxd ecb_decrypted.txt`` <span style="color:blue"> to display it</span><br>
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2022.01.13.png?raw=true"><br>
<span style="color:blue"> We can see that the content was decrypted correctly.</span><br>

# Task 2:  Encryption Mode – ECB vs. CBC
## Set up environment

<span style="color:blue">First we have a ``whale.bmp`` file: </span><br>
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2021.41.23.png?raw=true"><br>

## Split header and body of file 
### Split header
<span style="color:blue">We will use ``dd if=origin.bmp of=header.bin bs=1 count=54
`` to split the header(54 byte) </span><br>
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2022.23.47.png?raw=true"><br>
<span style="color:blue">This command copies the first 54 bytes from whale.bmp to header.bin. The first 54 bytes of a BMP file contain the header information, which includes details like the file size, dimensions, and other metadata required to interpret the image data correctly. </span><br>

### Split body
<span style="color:blue">We will use ``dd if=origin.bmp of=body.bin bs=1 skip=54`` to split the body (start from 55 byte)</span><br>
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Firewall/Screenshot%202024-07-15%20at%2020.05.38.png?raw=true"><br>
<span style="color:blue">This command copies the rest of the file (starting from byte 55) from whale.bmp to body.bin. This effectively extracts the image data, excluding the header. </span><br>

## Encrypt the body using ECB and CBC
### Encrypt using ECB
<span style="color:blue">We use ``openssl enc -aes-256-ecb -nosalt -in body.bin -out ecb_encrypted_body.bin -K 00112233445566778899AABBCCDDEEFF00112233445566778899AABBCCDDEEFF
`` to encrypt ``body.bin`` file and ``cat header.bin ecb_encrypted_body.bin > ecb_encrypted.bmp
`` to combined body with header to create the final encrypted BMP file
</span> <br>
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2022.42.53.png?raw=true"><br>
<span style="color:blue">``-aes-256-ecb``: Specifies the AES algorithm with a 256-bit key in ECB mode.
``-nosalt``: No salt is used.
``-in body.bin``: The input file is the body of the BMP file.
``-out ecb_encrypted_body.bin``: The output file is the encrypted body.
``-K``: The 256-bit encryption key, specified in hexadecimal.</span> <br>
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2022.37.06.png?raw=true"><br>


<span style="color:blue">The encrypted image shows a distorted pattern.
This distortion is characteristic of the ECB mode, where identical plaintext blocks are encrypted into identical ciphertext blocks. This often results in visible patterns when viewing the encrypted data as an image.
</span><br>
### Encrypt using CBC
<span style="color:blue">We use ``openssl enc -aes-256-cbc -nosalt -in body.bin -out cbc_encrypted_body.bin -K 00112233445566778899AABBCCDDEEFF00112233445566778899AABBCCDDEEFF -iv 0102030405060708090A0B0C0D0E0F10

`` to encrypt ``body.bin`` file and ``cat header.bin cbc_encrypted_body.bin > cbc_encrypted.bmp
`` to combined body with header to create the final encrypted BMP file
</span> <br>
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2022.42.53.png?raw=true"><br>

<span style="color:blue">``-aes-256-cbc``: Specifies the AES algorithm with a 256-bit key in CBC mode.
``-nosalt``: No salt is used.
``-in body.bin``: The input file is the body of the BMP file.
``-out cbc_encrypted_body.bin``: The output file is the encrypted body.
``-K``: The 256-bit encryption key, specified in hexadecimal.
``-iv``: The initialization vector (IV), specified in hexadecimal.
</span> <br>
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2022.49.56.png?raw=true"><br>
<span style="color:blue">The encrypted image shows a completely randomized pattern.
This is characteristic of the CBC mode, where each block of plaintext is XORed with the previous ciphertext block before being encrypted. This results in a high level of diffusion and makes the encrypted data appear random.
</span> <br>



# Task 3: Encryption Mode – Corrupted Cipher Text
## 3.1 Create a text file that is at least 64 bytes long.

<span style="color:blue">First we use ``echo "This is a test file. It needs to be at least 64 bytes long, so we are adding some extra text." > testfile.txt
`` to create a 64 bytes text file </span><br>
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2022.59.43.png?raw=true"><br>


## 3.2 Encrypt the file using the AES-256 cipher.
<span style="color:blue">We use ``openssl enc -aes-256-ecb -nosalt -in testfile.txt -out ecb_encrypted.txt -K 00112233445566778899AABBCCDDEEFF00112233445566778899AABBCCDDEEFF``to encrypt using AES-256-ECB 
</span> <br>
<span style="color:blue">We use ``openssl enc -aes-256-cbc -nosalt -in testfile.txt -out cbc_encrypted.txt -K 00112233445566778899AABBCCDDEEFF00112233445566778899AABBCCDDEEFF -iv 0102030405060708090A0B0C0D0E0F10``to encrypt using AES-256-EBC
</span> <br>
<span style="color:blue">We use:``openssl enc -aes-256-cfb -nosalt -in testfile.txt -out cfb_encrypted.txt -K 00112233445566778899AABBCCDDEEFF00112233445566778899AABBCCDDEEFF -iv 0102030405060708090A0B0C0D0E0F10
``to encrypt using AES-256-CFB
</span> <br>
<span style="color:blue">We use ``openssl enc -aes-256-ofb -nosalt -in testfile.txt -out ofb_encrypted.txt -K 00112233445566778899AABBCCDDEEFF00112233445566778899AABBCCDDEEFF -iv 0102030405060708090A0B0C0D0E0F10
``to encrypt using AES-256-OFB
</span> <br>

<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2023.08.15.png?raw=true"><br>

## 3.3 Corrupt a single bit of the 5th byte in the encrypted file.
<span style="color:blue">Now we will use dd to corrupt the 5th byte in every mode encrypted file
</span> <br>
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2023.13.30.png?raw=true"><br>
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2023.14.23.png?raw=true"><br>

## 3.4 Decrypt the corrupted file
<span style="color:blue">Now we will use decrypted the encrypted file
</span> <br>
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2023.17.07.png?raw=true"><br>

### ecb_decrypted.txt
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2023.20.35.png?raw=true"><br>
<span style="color:blue">Observation: In the ECB mode, the corruption affects only the block containing the corrupted byte. The rest of the decrypted file remains intact.
Explanation: ECB mode encrypts each block of plaintext independently. Therefore, an error in one block does not propagate to other blocks. However, this lack of diffusion makes ECB mode less secure, as patterns in the plaintext can become evident in the ciphertext.
</span> <br>

### cbc_decrypted.txt
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2023.20.15.png?raw=true"><br>
<span style="color:blue">Observation: In the CBC mode, the corruption affects the block containing the error and the subsequent block.
Explanation: CBC mode XORs each block of plaintext with the previous ciphertext block before encryption. An error in a ciphertext block affects the corresponding plaintext block upon decryption and also causes the next plaintext block to be corrupted due to the XOR operation.
</span> <br>

### cfb_decrypted.txt
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2023.21.57.png?raw=true"><br>
<span style="color:blue">Observation: In the CFB mode, the corruption affects only the corrupted byte and the next byte.
Explanation: CFB mode encrypts smaller units (usually bytes) of plaintext, and errors in one byte affect only the subsequent byte. This limited error propagation provides a balance between security and error tolerance.
</span> <br>

### ofb_decrypted.txt
<img width="500" alt="Screenshot" src="https://github.com/Will-Zidane/SecurityLab/blob/main/Encryption/Screenshot%202024-07-17%20at%2023.22.10.png?raw=true"><br>
<span style="color:blue">Observation: In the OFB mode, the corruption affects only the corrupted byte.
Explanation: OFB mode generates keystream blocks independently of the plaintext and XORs them with the plaintext to produce the ciphertext. Errors in the ciphertext affect only the corresponding plaintext byte upon decryption, making OFB suitable for applications requiring high error tolerance.
</span> <br>

<span style="color:blue">Link Discord :<a>https://github.com/Will-Zidane/SecurityLab/edit/main/19110113.md</a>
</span> <br>
